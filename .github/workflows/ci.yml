name: ci

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Validate cloud-init schema
        run: |
          cloud-init --version
          echo 'datasource_list: [ NoCloud, None ]' > /etc/cloud/cloud.cfg.d/90_dpkg.cfg
          cloud-init schema -c ubuntu/http/user-data
 
      - uses: hashicorp/setup-packer@main
        id: setup
        with:
          version: latest
